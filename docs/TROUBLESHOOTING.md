# LDIMS MCP æœåŠ¡æ•…éšœæ’é™¤æŒ‡å—

> **å¸¸è§é—®é¢˜è¯Šæ–­å’Œè§£å†³æ–¹æ¡ˆ**

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿè¯Šæ–­](#å¿«é€Ÿè¯Šæ–­)
- [å¯åŠ¨é—®é¢˜](#å¯åŠ¨é—®é¢˜)
- [é…ç½®é—®é¢˜](#é…ç½®é—®é¢˜)
- [API è¿æ¥é—®é¢˜](#api-è¿æ¥é—®é¢˜)
- [æ€§èƒ½é—®é¢˜](#æ€§èƒ½é—®é¢˜)
- [é”™è¯¯ä»£ç å‚è€ƒ](#é”™è¯¯ä»£ç å‚è€ƒ)
- [æ—¥å¿—åˆ†æ](#æ—¥å¿—åˆ†æ)
- [è°ƒè¯•å·¥å…·](#è°ƒè¯•å·¥å…·)

## ğŸ” å¿«é€Ÿè¯Šæ–­

### å¥åº·æ£€æŸ¥æ¸…å•

åœ¨æ·±å…¥æ’æŸ¥é—®é¢˜ä¹‹å‰ï¼Œè¯·å…ˆå®Œæˆä»¥ä¸‹åŸºç¡€æ£€æŸ¥ï¼š

- [ ] Node.js ç‰ˆæœ¬ >= 18.0.0
- [ ] npm ä¾èµ–å·²æ­£ç¡®å®‰è£…
- [ ] `.env` æ–‡ä»¶å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- [ ] LDIMS åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ç£ç›˜ç©ºé—´å……è¶³

### å¿«é€Ÿè¯Šæ–­å‘½ä»¤

```bash
# æ£€æŸ¥ Node.js ç‰ˆæœ¬
node --version

# æ£€æŸ¥é¡¹ç›®ä¾èµ–
npm list --depth=0

# æ£€æŸ¥é…ç½®
npm run config:check

# æ£€æŸ¥æ„å»ºçŠ¶æ€
npm run build

# è¿è¡Œå¥åº·æ£€æŸ¥
npm run health:check
```

## ğŸš€ å¯åŠ¨é—®é¢˜

### é—®é¢˜ 1: Cannot find module é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Error: Cannot find module './dist/index.js'
```

**åŸå› åˆ†æ**:
- é¡¹ç›®æœªæ„å»ºæˆ–æ„å»ºå¤±è´¥
- dist ç›®å½•ä¸å­˜åœ¨æˆ–ä¸ºç©º

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# é‡æ–°æ„å»ºé¡¹ç›®
npm run build

# æ£€æŸ¥æ„å»ºè¾“å‡º
ls -la dist/
```

### é—®é¢˜ 2: ç«¯å£å ç”¨é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Error: listen EADDRINUSE: address already in use :::3000
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -tulpn | grep :3000

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>

# æˆ–è€…ä½¿ç”¨ä¸åŒç«¯å£
export PORT=3001
npm start
```

### é—®é¢˜ 3: æƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Error: EACCES: permission denied
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la

# ä¿®å¤æƒé™ï¼ˆLinux/macOSï¼‰
chmod +x scripts/*
sudo chown -R $USER:$USER .

# Windows ä¸‹ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
```

## âš™ï¸ é…ç½®é—®é¢˜

### é—®é¢˜ 1: ç¯å¢ƒå˜é‡éªŒè¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
ConfigError: ç¯å¢ƒå˜é‡éªŒè¯å¤±è´¥:
  â€¢ LDIMS_API_BASE_URL: Required
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥ .env æ–‡ä»¶**:
   ```bash
   # ç¡®è®¤æ–‡ä»¶å­˜åœ¨
   ls -la .env
   
   # æ£€æŸ¥æ–‡ä»¶å†…å®¹
   cat .env
   ```

2. **å¤åˆ¶æ¨¡æ¿æ–‡ä»¶**:
   ```bash
   cp .env.example .env
   ```

3. **ç¼–è¾‘é…ç½®**:
   ```env
   # å¿…éœ€é…ç½®
   LDIMS_API_BASE_URL=http://localhost:3000/api
   
   # å¯é€‰é…ç½®
   LDIMS_API_TIMEOUT=30000
   LOG_LEVEL=info
   ```

### é—®é¢˜ 2: é…ç½®æ ¼å¼é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
ConfigError: æ— æ•ˆçš„LDIMS API URL: invalid-url
```

**è§£å†³æ–¹æ¡ˆ**:
```env
# âŒ é”™è¯¯æ ¼å¼
LDIMS_API_BASE_URL=invalid-url

# âœ… æ­£ç¡®æ ¼å¼
LDIMS_API_BASE_URL=http://localhost:3000/api
LDIMS_API_BASE_URL=https://api.ldims.com/v1
```

### é—®é¢˜ 3: æ•°å­—ç±»å‹é…ç½®é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
ConfigError: Expected number, received string
```

**è§£å†³æ–¹æ¡ˆ**:
```env
# âŒ é”™è¯¯ï¼šåŒ…å«éæ•°å­—å­—ç¬¦
LDIMS_API_TIMEOUT=30000ms

# âœ… æ­£ç¡®ï¼šçº¯æ•°å­—
LDIMS_API_TIMEOUT=30000
LDIMS_API_RETRY_COUNT=3
```

## ğŸ”— API è¿æ¥é—®é¢˜

### é—®é¢˜ 1: LDIMS API è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
Error: connect ECONNREFUSED 127.0.0.1:3000
```

**è¯Šæ–­æ­¥éª¤**:
1. **æ£€æŸ¥ LDIMS åç«¯çŠ¶æ€**:
   ```bash
   # æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
   curl http://localhost:3000/api/health
   
   # æ£€æŸ¥ç«¯å£ç›‘å¬
   netstat -tulpn | grep :3000
   ```

2. **æ£€æŸ¥ç½‘ç»œè¿æ¥**:
   ```bash
   # æµ‹è¯•ç½‘ç»œè¿é€šæ€§
   ping localhost
   telnet localhost 3000
   ```

3. **æ£€æŸ¥é˜²ç«å¢™è®¾ç½®**:
   ```bash
   # Linux æ£€æŸ¥é˜²ç«å¢™
   sudo ufw status
   
   # Windows æ£€æŸ¥é˜²ç«å¢™
   netsh advfirewall show allprofiles
   ```

**è§£å†³æ–¹æ¡ˆ**:
- å¯åŠ¨ LDIMS åç«¯æœåŠ¡
- æ£€æŸ¥ API åŸºç¡€ URL é…ç½®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- è°ƒæ•´é˜²ç«å¢™è§„åˆ™

### é—®é¢˜ 2: API è®¤è¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
Error: 401 Unauthorized
```

**è§£å†³æ–¹æ¡ˆ**:
```env
# æ£€æŸ¥è®¤è¯ä»¤ç‰Œé…ç½®
LDIMS_AUTH_TOKEN=your-valid-token-here

# æˆ–è€…è”ç³»ç®¡ç†å‘˜è·å–æœ‰æ•ˆä»¤ç‰Œ
```

### é—®é¢˜ 3: API è¶…æ—¶

**é”™è¯¯ä¿¡æ¯**:
```
Error: timeout of 30000ms exceeded
```

**è§£å†³æ–¹æ¡ˆ**:
```env
# å¢åŠ è¶…æ—¶æ—¶é—´
LDIMS_API_TIMEOUT=60000

# æˆ–è€…æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
ping api.ldims.com
```

## âš¡ æ€§èƒ½é—®é¢˜

### é—®é¢˜ 1: å“åº”æ—¶é—´è¿‡é•¿

**è¯Šæ–­æ–¹æ³•**:
```bash
# å¯ç”¨æ€§èƒ½ç›‘æ§
export LOG_LEVEL=debug
npm run dev

# æŸ¥çœ‹å“åº”æ—¶é—´æ—¥å¿—
tail -f logs/mcp-service.log | grep "execution_time"
```

**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. **å¢åŠ å¹¶å‘å¤„ç†**:
   ```env
   # è°ƒæ•´å¹¶å‘é™åˆ¶
   MAX_CONCURRENT_REQUESTS=10
   ```

2. **å¯ç”¨ç¼“å­˜**:
   ```env
   # å¯ç”¨ç»“æœç¼“å­˜
   ENABLE_CACHE=true
   CACHE_TTL=300
   ```

3. **ä¼˜åŒ–æŸ¥è¯¢å‚æ•°**:
   ```json
   {
     "query": "å…·ä½“çš„æœç´¢è¯",
     "maxResults": 5
   }
   ```

### é—®é¢˜ 2: å†…å­˜ä½¿ç”¨è¿‡é«˜

**ç›‘æ§å‘½ä»¤**:
```bash
# ç›‘æ§å†…å­˜ä½¿ç”¨
top -p $(pgrep -f "node.*index.js")

# æˆ–ä½¿ç”¨ htop
htop -p $(pgrep -f "node.*index.js")
```

**è§£å†³æ–¹æ¡ˆ**:
1. **é‡å¯æœåŠ¡**:
   ```bash
   npm run restart
   ```

2. **è°ƒæ•´å†…å­˜é™åˆ¶**:
   ```bash
   # å¢åŠ  Node.js å†…å­˜é™åˆ¶
   export NODE_OPTIONS="--max-old-space-size=4096"
   npm start
   ```

3. **æ£€æŸ¥å†…å­˜æ³„æ¼**:
   ```bash
   # ç”Ÿæˆå†…å­˜å¿«ç…§
   npm run memory:profile
   ```

## ğŸš¨ é”™è¯¯ä»£ç å‚è€ƒ

### MCP é”™è¯¯ä»£ç 

| é”™è¯¯ä»£ç  | æè¿° | å¸¸è§åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|------|----------|----------|
| `INVALID_PARAMS` | å‚æ•°éªŒè¯å¤±è´¥ | å‚æ•°ç±»å‹é”™è¯¯ã€ç¼ºå°‘å¿…éœ€å‚æ•° | æ£€æŸ¥å‚æ•°æ ¼å¼å’Œç±»å‹ |
| `TOOL_NOT_FOUND` | å·¥å…·ä¸å­˜åœ¨ | è°ƒç”¨äº†ä¸å­˜åœ¨çš„å·¥å…·åç§° | æ£€æŸ¥å·¥å…·åç§°æ‹¼å†™ |
| `RESOURCE_NOT_FOUND` | èµ„æºä¸å­˜åœ¨ | è¯·æ±‚äº†ä¸å­˜åœ¨çš„èµ„æº | æ£€æŸ¥èµ„æº URI æ ¼å¼ |
| `API_ERROR` | API è°ƒç”¨å¤±è´¥ | LDIMS åç«¯ API ä¸å¯ç”¨ | æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€ |
| `TIMEOUT` | è¯·æ±‚è¶…æ—¶ | ç½‘ç»œå»¶è¿Ÿæˆ–æœåŠ¡å™¨å“åº”æ…¢ | å¢åŠ è¶…æ—¶æ—¶é—´æˆ–æ£€æŸ¥ç½‘ç»œ |
| `INTERNAL_ERROR` | å†…éƒ¨é”™è¯¯ | æœåŠ¡å™¨å†…éƒ¨å¼‚å¸¸ | æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Œè”ç³»æŠ€æœ¯æ”¯æŒ |

### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | æè¿° | å¤„ç†æ–¹å¼ |
|--------|------|----------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼ |
| 401 | è®¤è¯å¤±è´¥ | æ£€æŸ¥è®¤è¯ä»¤ç‰Œ |
| 403 | æƒé™ä¸è¶³ | è”ç³»ç®¡ç†å‘˜åˆ†é…æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥èµ„æºè·¯å¾„ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿— |
| 502 | ç½‘å…³é”™è¯¯ | æ£€æŸ¥ä¸Šæ¸¸æœåŠ¡çŠ¶æ€ |
| 503 | æœåŠ¡ä¸å¯ç”¨ | ç­‰å¾…æœåŠ¡æ¢å¤æˆ–è”ç³»ç®¡ç†å‘˜ |

## ğŸ“Š æ—¥å¿—åˆ†æ

### æ—¥å¿—çº§åˆ«

- **ERROR**: é”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦ç«‹å³å¤„ç†
- **WARN**: è­¦å‘Šä¿¡æ¯ï¼Œå¯èƒ½å½±å“åŠŸèƒ½
- **INFO**: ä¸€èˆ¬ä¿¡æ¯ï¼Œæ­£å¸¸è¿è¡ŒçŠ¶æ€
- **DEBUG**: è°ƒè¯•ä¿¡æ¯ï¼Œè¯¦ç»†æ‰§è¡Œè¿‡ç¨‹

### æ—¥å¿—æ ¼å¼

```json
{
  "timestamp": "2024-12-19T10:30:00.000Z",
  "level": "INFO",
  "message": "MCP tool called",
  "tool": "searchDocuments",
  "params": {
    "query": "æŠ€æœ¯æ–‡æ¡£",
    "maxResults": 5
  },
  "execution_time": "245ms",
  "request_id": "req-12345"
}
```

### å¸¸ç”¨æ—¥å¿—æŸ¥è¯¢

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/mcp-service.log

# æŸ¥çœ‹ç‰¹å®šå·¥å…·çš„è°ƒç”¨
grep "searchDocuments" logs/mcp-service.log

# æŸ¥çœ‹å“åº”æ—¶é—´è¶…è¿‡ 1 ç§’çš„è¯·æ±‚
grep -E "execution_time.*[0-9]{4,}ms" logs/mcp-service.log

# å®æ—¶ç›‘æ§æ—¥å¿—
tail -f logs/mcp-service.log | grep -E "(ERROR|WARN)"
```

## ğŸ› ï¸ è°ƒè¯•å·¥å…·

### å†…ç½®è°ƒè¯•å‘½ä»¤

```bash
# é…ç½®æ£€æŸ¥
npm run config:check

# è¿æ¥æµ‹è¯•
npm run test:connection

# æ€§èƒ½åˆ†æ
npm run analyze

# å†…å­˜åˆ†æ
npm run memory:profile
```

### å¤–éƒ¨å·¥å…·

1. **ç½‘ç»œè°ƒè¯•**:
   ```bash
   # ä½¿ç”¨ curl æµ‹è¯• API
   curl -X GET "http://localhost:3000/api/health"
   
   # ä½¿ç”¨ wget ä¸‹è½½å“åº”
   wget -O - "http://localhost:3000/api/health"
   ```

2. **è¿›ç¨‹ç›‘æ§**:
   ```bash
   # ç›‘æ§è¿›ç¨‹çŠ¶æ€
   ps aux | grep node
   
   # ç›‘æ§èµ„æºä½¿ç”¨
   top -p $(pgrep -f node)
   ```

3. **ç½‘ç»œç›‘æ§**:
   ```bash
   # ç›‘æ§ç½‘ç»œè¿æ¥
   netstat -tulpn | grep node
   
   # ç›‘æ§ç½‘ç»œæµé‡
   iftop -i eth0
   ```

### VS Code è°ƒè¯•é…ç½®

åˆ›å»º `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Debug MCP Server",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/src/index.ts",
      "env": {
        "NODE_ENV": "development",
        "LOG_LEVEL": "debug"
      },
      "runtimeArgs": ["-r", "tsx/cjs"],
      "console": "integratedTerminal"
    }
  ]
}
```

## ğŸ†˜ è·å–å¸®åŠ©

### è‡ªåŠ©èµ„æº

1. **æŸ¥çœ‹æ–‡æ¡£**:
   - [README.md](../README.md)
   - [API å‚è€ƒ](API_REFERENCE.md)
   - [å¼€å‘è€…æŒ‡å—](DEVELOPER_GUIDE.md)

2. **æœç´¢å·²çŸ¥é—®é¢˜**:
   - é¡¹ç›® Issues
   - å¸¸è§é—®é¢˜ FAQ

3. **ç¤¾åŒºæ”¯æŒ**:
   - GitHub Discussions
   - æŠ€æœ¯è®ºå›

### è”ç³»æŠ€æœ¯æ”¯æŒ

å¦‚æœé—®é¢˜ä»æœªè§£å†³ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **ç¯å¢ƒä¿¡æ¯**:
   ```bash
   # æ”¶é›†ç¯å¢ƒä¿¡æ¯
   npm run env:info
   ```

2. **é”™è¯¯æ—¥å¿—**:
   ```bash
   # å¯¼å‡ºæœ€è¿‘çš„é”™è¯¯æ—¥å¿—
   tail -n 100 logs/mcp-service.log > error-report.log
   ```

3. **é…ç½®ä¿¡æ¯**:
   ```bash
   # å¯¼å‡ºé…ç½®ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰
   npm run config:export
   ```

4. **é‡ç°æ­¥éª¤**:
   - è¯¦ç»†æè¿°é—®é¢˜å‘ç”Ÿçš„æ­¥éª¤
   - æä¾›æœ€å°é‡ç°ç¤ºä¾‹
   - è¯´æ˜é¢„æœŸè¡Œä¸ºå’Œå®é™…è¡Œä¸º

---

**ç»´æŠ¤å›¢é˜Ÿ**: LDIMS æŠ€æœ¯æ”¯æŒ  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0